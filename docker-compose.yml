version: '3.9'

services:
  # nopCommerce application
  nopcommerce:
    image: nopcommerceteam/nopcommerce:4.70.6
    container_name: nopcommerce
    ports:
      - "5000:80"
    environment:
      - ASPNETCORE_ENVIRONMENT=Development

  # Python test runner container (Local Chrome driver)
  test-runner:
    image: python:3.11-slim
    container_name: test-runner
    depends_on:
      - nopcommerce
    working_dir: /app
    volumes:
      - ./:/app
      - ./Reports:/app/Reports
      - ./Screenshots:/app/Screenshots
      - ./Logs:/app/Logs
    environment:
      - BASE_URL=http://nopcommerce:5000
      - HEADLESS=false
    command: >
      sh -c "
      apt-get update &&
      apt-get install -y chromium-browser &&
      pip install --upgrade pip &&
      pip install -r Configurations/requirements.txt &&
      pytest testCases -v
      "
    shm_size: 2gb